// --- FITUR SEARCH API (VIA PROXY SERVER) ---
async function searchFromAPI() {
    const query = document.getElementById('urlInput').value;
    if(query.length < 3) return;

    logBox.innerText = "Status: Mencari...";
    resultBox.style.display = 'block';
    resultBox.innerHTML = '<div style="padding:15px;">Mencari di database...</div>';

    try {
        // Panggil ke server sendiri, bukan langsung ke dramabos
        const res = await fetch(`/api/search?q=${query}`);
        const data = await res.json();
        
        // Sesuaikan dengan struktur JSON Dramabos (biasanya data ada di dalam .data atau .results)
        const items = data.data || data; 
        
        resultBox.innerHTML = '';
        items.forEach(item => {
            const el = document.createElement('div');
            el.className = 'search-item';
            // Sesuaikan properti (title, thumb/poster, slug/id)
            el.innerHTML = `
                <img src="${item.thumb || item.poster || ''}">
                <b>${item.title}</b>
            `;
            // Gunakan slug/id untuk watch
            el.onclick = () => selectVideo(item.slug || item.id);
            resultBox.appendChild(el);
        });
    } catch(e) { 
        resultBox.innerHTML = '<div style="padding:15px;">Pencarian gagal atau tidak ditemukan.</div>'; 
    }
}

async function selectVideo(slug) {
    resultBox.style.display = 'none';
    logBox.innerText = "Status: Menyiapkan Streaming...";
    try {
        const res = await fetch(`/api/watch?id=${slug}`);
        const data = await res.json();
        
        // Dramabos biasanya memberikan link m3u8 di data.stream_url atau data.file
        const streamUrl = data.data?.stream_url || data.stream_url || data.url;
        
        if(streamUrl) {
            executeLoad(streamUrl);
        } else {
            alert("Link video tidak ditemukan di API ini.");
        }
    } catch(e) { 
        logBox.innerText = "Error: Gagal mengambil link stream."; 
    }
}
