<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watch Party - Happy Hues Edition</title>
    <script src="/socket.io/socket.io.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        /* Palet Warna Happy Hues */
        :root {
            --bg: #0f0e17;
            --headline: #fffffe;
            --paragraph: #a7a9be;
            --button: #ff8906;
            --accent: #f25f4c;
            --tertiary: #e53170; /* Warna Pink Utama */
            --card-bg: #16161a;
        }

        body { 
            background: var(--bg); 
            color: var(--paragraph); 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            margin: 0; 
            display: flex; 
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .main-layout { 
            display: flex; 
            gap: 24px; 
            max-width: 1400px; 
            width: 95%; 
            height: 85vh;
        }
        
        /* Bagian Video (Besar & Proper) */
        .video-section { 
            flex: 2.5; 
            background: var(--card-bg); 
            padding: 24px; 
            border-radius: 24px; 
            display: flex;
            flex-direction: column;
            border: 1px solid #242629;
        }

        .video-header { display: flex; gap: 12px; margin-bottom: 20px; }

        input { 
            background: #0f0e17; 
            border: 2px solid #242629; 
            padding: 14px; 
            border-radius: 12px; 
            color: #fff; 
            outline: none; 
            flex: 1;
            font-size: 14px;
        }
        input:focus { border-color: var(--tertiary); }

        button { 
            background: var(--tertiary); 
            color: white; 
            border: none; 
            padding: 0 24px; 
            border-radius: 12px; 
            cursor: pointer; 
            font-weight: 800; 
            transition: 0.3s;
        }
        button:hover { filter: brightness(1.2); transform: translateY(-2px); }

        /* Pembungkus Video Agar Besar */
        .video-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* Rasio 16:9 */
            height: 0;
            background: #000;
            border-radius: 16px;
            overflow: hidden;
            flex-grow: 1;
        }
        .video-container iframe, #player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100% !important;
            height: 100% !important;
            border: none;
        }

        /* Bagian Chat */
        .chat-section { 
            flex: 1; 
            background: var(--card-bg); 
            padding: 24px; 
            border-radius: 24px; 
            display: flex; 
            flex-direction: column; 
            border: 1px solid #242629;
            min-width: 320px;
        }

        #chat-box { 
            flex: 1; 
            overflow-y: auto; 
            margin-bottom: 16px; 
            padding-right: 8px; 
        }

        .msg { 
            margin-bottom: 12px; 
            font-size: 14px; 
            background: #242629; 
            padding: 12px; 
            border-radius: 12px; 
            width: fit-content; 
            max-width: 85%;
            line-height: 1.4;
        }
        .msg b { color: var(--tertiary); display: block; margin-bottom: 2px; font-size: 12px; }

        h2, h3 { color: var(--headline); margin-top: 0; margin-bottom: 15px; }
    </style>
</head>
<body>
    <div class="main-layout">
        <div class="video-section">
            <h2>ðŸŽ¥ Streaming Room</h2>
            <div class="video-header">
                <input type="text" id="urlInput" placeholder="Tempel ID Video YouTube (Contoh: dQw4w9WgXcQ)">
                <button onclick="changeVideo()">PUTAR</button>
            </div>
            <div class="video-container">
                <div id="player"></div>
            </div>
        </div>

        <div class="chat-section">
            <h3>ðŸ’¬ Chat Bareng</h3>
            <div id="chat-box"></div>
            <div style="display: flex; gap: 8px;">
                <input type="text" id="chatInput" placeholder="Ketik pesan..." style="width: 100%;">
                <button onclick="sendChat()" style="padding: 12px;">KIRIM</button>
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        let player, isSyncing = false;

        // Load YouTube API
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        document.body.appendChild(tag);

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                videoId: 'dQw4w9WgXcQ', // Video Default
                playerVars: { 'autoplay': 0, 'rel': 0, 'showinfo': 0 },
                events: { 'onStateChange': onPlayerStateChange }
            });
        }

        // Kontrol Video (Logika Original Kamu)
        function onPlayerStateChange(event) {
            if (isSyncing) return;
            const time = player.getCurrentTime();
            if (event.data == YT.PlayerState.PLAYING) socket.emit('video-control', { action: 'play', time });
            if (event.data == YT.PlayerState.PAUSED) socket.emit('video-control', { action: 'pause', time });
        }

        function changeVideo() {
            const vid = document.getElementById('urlInput').value;
            if(!vid) return;
            socket.emit('video-control', { action: 'change', vid });
            player.loadVideoById(vid);
        }

        // Fitur Chat
        function sendChat() {
            const msg = document.getElementById('chatInput').value;
            if(!msg) return;
            socket.emit('new-message', msg);
            addMessage("Kamu", msg);
            document.getElementById('chatInput').value = "";
        }

        function addMessage(user, text) {
            const box = document.getElementById('chat-box');
            const color = user === "Kamu" ? "var(--paragraph)" : "white";
            box.innerHTML += `<div class="msg" style="color: ${color}"><b>${user}</b>${text}</div>`;
            box.scrollTop = box.scrollHeight;
        }

        // Menerima Sinyal dari Server (Logika Original Kamu)
        socket.on('video-control', (data) => {
            isSyncing = true;
            if (data.action === 'play') { player.seekTo(data.time); player.playVideo(); }
            if (data.action === 'pause') player.pauseVideo();
            if (data.action === 'change') player.loadVideoById(data.vid);
            setTimeout(() => isSyncing = false, 600);
        });

        socket.on('chat-receive', (msg) => {
            addMessage("Dia", msg);
        });

        document.getElementById('chatInput').addEventListener("keyup", (e) => {
            if (e.key === "Enter") sendChat();
        });
    </script>
</body>
</html>
