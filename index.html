<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Watch Party</title>

<script src="/socket.io/socket.io.js"></script>
<link rel="stylesheet"
 href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>

<style>
:root{
--bg:#0f172a;--surface:#111827;--soft:#1f2937;
--text:#f8fafc;--muted:#94a3b8;
--primary:#38bdf8;--accent:#22c55e;--border:#1e293b;
}
body{margin:0;background:var(--bg);color:var(--text);font-family:sans-serif;height:100vh}
.app{display:flex;height:100vh}
.video{flex:3;padding:10px;display:flex;flex-direction:column;gap:8px}
.side{flex:1;background:var(--surface);padding:10px;display:flex;flex-direction:column;gap:6px}
input,button{background:var(--soft);border:1px solid var(--border);color:white;border-radius:10px;padding:8px}
button{background:var(--primary);color:black;font-weight:700}
iframe,video{width:100%;height:100%;border:0;border-radius:14px}
.player{flex:1}
.users span{font-size:12px;margin-right:6px}
.chat{flex:1;overflow:auto;border:1px solid var(--border);padding:6px;border-radius:10px}
@media(max-width:768px){.app{flex-direction:column}.side{height:40vh}}
</style>
</head>

<body>

<div id="login" style="position:fixed;inset:0;background:#000a;display:flex;align-items:center;justify-content:center">
<div style="background:var(--surface);padding:20px;border-radius:16px">
<input id="name" placeholder="Nama">
<button onclick="join()">Masuk</button>
</div>
</div>

<div class="app">
<div class="video">
<div style="display:flex;gap:6px">
<input id="src" placeholder="Paste LINK video apa aja">
<button onclick="setVideo()"><i class="fa fa-play"></i></button>
</div>
<div class="player" id="playerBox"></div>
</div>

<div class="side">
<div class="users" id="users"></div>
<div class="chat" id="chat"></div>
<div style="display:flex;gap:6px">
<input id="chatInput" placeholder="Chat" onkeydown="if(event.key=='Enter')send()">
<button onclick="send()">âž¤</button>
</div>
</div>
</div>

<script>
const socket=io();
let isSync=false,myName="";
const history=JSON.parse(localStorage.getItem("history")||"[]");

function join(){
myName=name.value;
login.style.display="none";
socket.emit("join",myName);
}

function setVideo(){
const s=src.value;
load(s,0);
saveHistory(s);
socket.emit("video",{src:s,time:0,playing:true});
}

function load(s,t){
isSync=true;
playerBox.innerHTML = s.endsWith(".mp4")||s.endsWith(".webm")
? `<video src="${s}" controls autoplay></video>`
: `<iframe src="${s}" allow="autoplay; fullscreen"></iframe>`;
setTimeout(()=>isSync=false,1000);
}

socket.on("init",d=>d.src&&load(d.src,d.time));
socket.on("sync",d=>!isSync&&load(d.src,d.time));

socket.on("users",list=>{
users.innerHTML=list.map(u=>`<span>ðŸ‘€ ${u.name}</span>`).join("");
});

function send(){
if(!chatInput.value)return;
chat.innerHTML+=`<div><b>Kamu:</b> ${chatInput.value}</div>`;
socket.emit("chat",chatInput.value);
chatInput.value="";
}

socket.on("chat",d=>{
chat.innerHTML+=`<div><b>${d.user}:</b> ${d.msg}</div>`;
});

function saveHistory(s){
history.unshift(s);
history.splice(5);
localStorage.setItem("history",JSON.stringify(history));
}
</script>
</body>
</html>