<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Nobar</title>
<script src="/socket.io/socket.io.js"></script>
<style>
body {
  font-family: sans-serif;
  background:#f9fafb;
  margin:0;
}
#joinBox {
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:white;
}
#app { display:none; padding:12px }
video, iframe {
  width:100%;
  max-height:60vh;
  background:black;
}
.user { font-size:12px }
</style>
</head>
<body>

<div id="joinBox">
  <div>
    <h3>Masukkan Nickname</h3>
    <input id="nick" placeholder="nickname"/>
    <button id="joinBtn">Join</button>
  </div>
</div>

<div id="app">
  <input id="videoUrl" placeholder="Paste link video"/>
  <button id="setVideo">Putar</button>

  <iframe id="player" allow="autoplay" allowfullscreen></iframe>

  <div id="users"></div>
</div>

<script>
const socket = io();
const joinBox = document.getElementById("joinBox");
const app = document.getElementById("app");

const nickInput = document.getElementById("nick");
const joinBtn = document.getElementById("joinBtn");

const player = document.getElementById("player");
const videoUrlInput = document.getElementById("videoUrl");
const setVideoBtn = document.getElementById("setVideo");
const usersDiv = document.getElementById("users");

joinBtn.onclick = () => {
  const nickname = nickInput.value.trim();
  if (!nickname) return alert("isi nickname");

  socket.emit("join", { nickname });

  joinBox.style.display = "none";
  app.style.display = "block";
};

setVideoBtn.onclick = () => {
  const url = videoUrlInput.value.trim();
  if (!url) return;
  socket.emit("set-video", url);
  setPlayer(url);
};

function setPlayer(url){
  player.src = url;
}

socket.on("set-video", setPlayer);

socket.on("sync-state", (state)=>{
  if(state.videoUrl){
    setPlayer(state.videoUrl);
  }
});

socket.on("user-status", (u)=>{
  const div = document.createElement("div");
  div.className = "user";
  div.textContent = `${u.nickname} ${u.status}`;
  usersDiv.appendChild(div);
});
</script>

</body>
</html>